{"version":3,"file":"jsmind.draggable-node.js","sources":["../src/plugins/jsmind.draggable-node.js"],"sourcesContent":["/**\n * @license BSD\n * @copyright 2014-2023 hizzgdev@163.com\n *\n * Project Home:\n *   https://github.com/hizzgdev/jsmind/\n */\n\nimport jsMind from 'jsmind';\n\nif (!jsMind) {\n    throw new Error('jsMind is not defined');\n}\n\nconst $ = jsMind.$;\n\nconst clear_selection =\n    'getSelection' in $.w\n        ? function () {\n              $.w.getSelection().removeAllRanges();\n          }\n        : function () {\n              $.d.selection.empty();\n          };\n\nconst DEFAULT_OPTIONS = {\n    line_width: 5,\n    line_color: 'rgba(0,0,0,0.3)',\n    drag_start_delay: 100,\n    lookup_delay: 500,\n    lookup_interval: 80,\n    scrolling_trigger_width: 20,\n    scrolling_step_length: 10,\n};\n\nclass DraggableNode {\n    constructor(jm, options) {\n        var opts = {};\n        jsMind.util.json.merge(opts, DEFAULT_OPTIONS);\n        jsMind.util.json.merge(opts, options);\n\n        this.version = '0.3.0';\n        this.jm = jm;\n        this.options = opts;\n        this.e_canvas = null;\n        this.canvas_ctx = null;\n        this.shadow = null;\n        this.shadow_w = 0;\n        this.shadow_h = 0;\n        this.active_node = null;\n        this.target_node = null;\n        this.target_direct = null;\n        this.client_w = 0;\n        this.client_h = 0;\n        this.offset_x = 0;\n        this.offset_y = 0;\n        this.hlookup_delay = 0;\n        this.hlookup_timer = 0;\n        this.hdrag_start_delay = 0;\n        this.capture = false;\n        this.moved = false;\n        this.canvas_draggable = jm.get_view_draggable();\n        this.view_panel = jm.view.e_panel;\n        this.view_panel_rect = null;\n    }\n    init() {\n        this._create_canvas();\n        this._create_shadow();\n        this._event_bind();\n    }\n    resize() {\n        this.jm.view.e_nodes.appendChild(this.shadow);\n        this.e_canvas.width = this.jm.view.size.w;\n        this.e_canvas.height = this.jm.view.size.h;\n    }\n    _create_canvas() {\n        var c = $.c('canvas');\n        this.jm.view.e_panel.appendChild(c);\n        var ctx = c.getContext('2d');\n        this.e_canvas = c;\n        this.canvas_ctx = ctx;\n    }\n    _create_shadow() {\n        var s = $.c('jmnode');\n        s.style.visibility = 'hidden';\n        s.style.zIndex = '3';\n        s.style.cursor = 'move';\n        s.style.opacity = '0.7';\n        this.shadow = s;\n    }\n    reset_shadow(el) {\n        var s = this.shadow.style;\n        this.shadow.innerHTML = el.innerHTML;\n        s.left = el.style.left;\n        s.top = el.style.top;\n        s.width = el.style.width;\n        s.height = el.style.height;\n        s.backgroundImage = el.style.backgroundImage;\n        s.backgroundSize = el.style.backgroundSize;\n        s.transform = el.style.transform;\n        this.shadow_w = this.shadow.clientWidth;\n        this.shadow_h = this.shadow.clientHeight;\n    }\n    show_shadow() {\n        if (!this.moved) {\n            this.shadow.style.visibility = 'visible';\n        }\n    }\n    hide_shadow() {\n        this.shadow.style.visibility = 'hidden';\n    }\n    _magnet_shadow(node) {\n        if (!!node) {\n            this.canvas_ctx.lineWidth = this.options.line_width;\n            this.canvas_ctx.strokeStyle = this.options.line_color;\n            this.canvas_ctx.lineCap = 'round';\n            this._clear_lines();\n            this._canvas_lineto(node.sp.x, node.sp.y, node.np.x, node.np.y);\n        }\n    }\n    _clear_lines() {\n        this.canvas_ctx.clearRect(0, 0, this.jm.view.size.w, this.jm.view.size.h);\n    }\n    _canvas_lineto(x1, y1, x2, y2) {\n        this.canvas_ctx.beginPath();\n        this.canvas_ctx.moveTo(x1, y1);\n        this.canvas_ctx.lineTo(x2, y2);\n        this.canvas_ctx.stroke();\n    }\n    _lookup_close_node() {\n        var root = this.jm.get_root();\n        var root_location = root.get_location();\n        var root_size = root.get_size();\n        var root_x = root_location.x + root_size.w / 2;\n\n        var sw = this.shadow_w;\n        var sh = this.shadow_h;\n        var sx = this.shadow.offsetLeft;\n        var sy = this.shadow.offsetTop;\n\n        var ns, nl;\n\n        var direct = sx + sw / 2 >= root_x ? jsMind.direction.right : jsMind.direction.left;\n        var nodes = this.jm.mind.nodes;\n        var node = null;\n        var layout = this.jm.layout;\n        var min_distance = Number.MAX_VALUE;\n        var distance = 0;\n        var closest_node = null;\n        var closest_p = null;\n        var shadow_p = null;\n        for (var nodeid in nodes) {\n            var np, sp;\n            node = nodes[nodeid];\n            if (node.isroot || node.direction == direct) {\n                if (node.id == this.active_node.id) {\n                    continue;\n                }\n                if (!layout.is_visible(node)) {\n                    continue;\n                }\n                ns = node.get_size();\n                nl = node.get_location();\n                if (direct == jsMind.direction.right) {\n                    if (sx - nl.x - ns.w <= 0) {\n                        continue;\n                    }\n                    distance = Math.abs(sx - nl.x - ns.w) + Math.abs(sy + sh / 2 - nl.y - ns.h / 2);\n                    np = { x: nl.x + ns.w - this.options.line_width, y: nl.y + ns.h / 2 };\n                    sp = { x: sx + this.options.line_width, y: sy + sh / 2 };\n                } else {\n                    if (nl.x - sx - sw <= 0) {\n                        continue;\n                    }\n                    distance = Math.abs(sx + sw - nl.x) + Math.abs(sy + sh / 2 - nl.y - ns.h / 2);\n                    np = { x: nl.x + this.options.line_width, y: nl.y + ns.h / 2 };\n                    sp = { x: sx + sw - this.options.line_width, y: sy + sh / 2 };\n                }\n                if (distance < min_distance) {\n                    closest_node = node;\n                    closest_p = np;\n                    shadow_p = sp;\n                    min_distance = distance;\n                }\n            }\n        }\n        var result_node = null;\n        if (!!closest_node) {\n            result_node = {\n                node: closest_node,\n                direction: direct,\n                sp: shadow_p,\n                np: closest_p,\n            };\n        }\n        return result_node;\n    }\n    lookup_close_node() {\n        var node_data = this._lookup_close_node();\n        if (!!node_data) {\n            this._magnet_shadow(node_data);\n            this.target_node = node_data.node;\n            this.target_direct = node_data.direction;\n        }\n    }\n    _event_bind() {\n        var jd = this;\n        var container = this.jm.view.container;\n        $.on(container, 'mousedown', function (e) {\n            var evt = e || event;\n            jd.hdrag_start_delay = $.w.setTimeout(function () {\n                jd.hdrag_start_delay = 0;\n                jd.dragstart.call(jd, evt);\n            }, jd.options.drag_start_delay);\n        });\n        $.on(container, 'mousemove', function (e) {\n            var evt = e || event;\n            jd.drag.call(jd, evt);\n        });\n        $.on(container, 'mouseup', function (e) {\n            var evt = e || event;\n            if (jd.hdrag_start_delay != 0) {\n                $.w.clearTimeout(jd.hdrag_start_delay);\n                jd.hdrag_start_delay = 0;\n            }\n            jd.dragend.call(jd, evt);\n        });\n        $.on(container, 'touchstart', function (e) {\n            var evt = e || event;\n            jd.hdrag_start_delay = $.w.setTimeout(function () {\n                jd.hdrag_start_delay = 0;\n                jd.dragstart.call(jd, evt);\n            }, jd.options.drag_start_delay);\n        });\n        $.on(container, 'touchmove', function (e) {\n            var evt = e || event;\n            jd.drag.call(jd, evt);\n        });\n        $.on(container, 'touchend', function (e) {\n            var evt = e || event;\n            if (jd.hdrag_start_delay != 0) {\n                $.w.clearTimeout(jd.hdrag_start_delay);\n                jd.hdrag_start_delay = 0;\n            }\n            jd.dragend.call(jd, evt);\n        });\n    }\n    dragstart(e) {\n        if (!this.jm.get_editable()) {\n            return;\n        }\n        if (this.capture) {\n            return;\n        }\n        this.active_node = null;\n        this.view_draggable = this.jm.get_view_draggable();\n\n        var jview = this.jm.view;\n        var el = e.target || event.srcElement;\n        if (el.tagName.toLowerCase() != 'jmnode') {\n            return;\n        }\n        if (this.view_draggable) {\n            this.jm.disable_view_draggable();\n        }\n        var nodeid = jview.get_binded_nodeid(el);\n        if (!!nodeid) {\n            var node = this.jm.get_node(nodeid);\n            if (!node.isroot) {\n                this.reset_shadow(el);\n                this.view_panel_rect = this.view_panel.getBoundingClientRect();\n                this.active_node = node;\n                this.offset_x =\n                    (e.clientX || e.touches[0].clientX) / jview.zoom_current - el.offsetLeft;\n                this.offset_y =\n                    (e.clientY || e.touches[0].clientY) / jview.zoom_current - el.offsetTop;\n                this.client_hw = Math.floor(el.clientWidth / 2);\n                this.client_hh = Math.floor(el.clientHeight / 2);\n                if (this.hlookup_delay != 0) {\n                    $.w.clearTimeout(this.hlookup_delay);\n                }\n                if (this.hlookup_timer != 0) {\n                    $.w.clearInterval(this.hlookup_timer);\n                }\n                var jd = this;\n                this.hlookup_delay = $.w.setTimeout(function () {\n                    jd.hlookup_delay = 0;\n                    jd.hlookup_timer = $.w.setInterval(function () {\n                        jd.lookup_close_node.call(jd);\n                    }, jd.options.lookup_interval);\n                }, this.options.lookup_delay);\n                jd.capture = true;\n            }\n        }\n    }\n    drag(e) {\n        if (!this.jm.get_editable()) {\n            return;\n        }\n        if (this.capture) {\n            e.preventDefault();\n            this.show_shadow();\n            this.moved = true;\n            clear_selection();\n            var jview = this.jm.view;\n            var px = (e.clientX || e.touches[0].clientX) / jview.zoom_current - this.offset_x;\n            var py = (e.clientY || e.touches[0].clientY) / jview.zoom_current - this.offset_y;\n            // scrolling container axisY if drag nodes exceeding container\n            if (\n                e.clientY - this.view_panel_rect.top < this.options.scrolling_trigger_width &&\n                this.view_panel.scrollTop > this.options.scrolling_step_length\n            ) {\n                this.view_panel.scrollBy(0, -this.options.scrolling_step_length);\n                this.offset_y += this.options.scrolling_step_length / jview.zoom_current;\n            } else if (\n                this.view_panel_rect.bottom - e.clientY < this.options.scrolling_trigger_width &&\n                this.view_panel.scrollTop <\n                    this.view_panel.scrollHeight -\n                        this.view_panel_rect.height -\n                        this.options.scrolling_step_length\n            ) {\n                this.view_panel.scrollBy(0, this.options.scrolling_step_length);\n                this.offset_y -= this.options.scrolling_step_length / jview.zoom_current;\n            }\n            // scrolling container axisX if drag nodes exceeding container\n            if (\n                e.clientX - this.view_panel_rect.left < this.options.scrolling_trigger_width &&\n                this.view_panel.scrollLeft > this.options.scrolling_step_length\n            ) {\n                this.view_panel.scrollBy(-this.options.scrolling_step_length, 0);\n                this.offset_x += this.options.scrolling_step_length / jview.zoom_current;\n            } else if (\n                this.view_panel_rect.right - e.clientX < this.options.scrolling_trigger_width &&\n                this.view_panel.scrollLeft <\n                    this.view_panel.scrollWidth -\n                        this.view_panel_rect.width -\n                        this.options.scrolling_step_length\n            ) {\n                this.view_panel.scrollBy(this.options.scrolling_step_length, 0);\n                this.offset_x -= this.options.scrolling_step_length / jview.zoom_current;\n            }\n            this.shadow.style.left = px + 'px';\n            this.shadow.style.top = py + 'px';\n            clear_selection();\n        }\n    }\n    dragend(e) {\n        if (!this.jm.get_editable()) {\n            return;\n        }\n        if (this.view_draggable) {\n            this.jm.enable_view_draggable();\n        }\n        if (this.capture) {\n            if (this.hlookup_delay != 0) {\n                $.w.clearTimeout(this.hlookup_delay);\n                this.hlookup_delay = 0;\n                this._clear_lines();\n            }\n            if (this.hlookup_timer != 0) {\n                $.w.clearInterval(this.hlookup_timer);\n                this.hlookup_timer = 0;\n                this._clear_lines();\n            }\n            if (this.moved) {\n                var src_node = this.active_node;\n                var target_node = this.target_node;\n                var target_direct = this.target_direct;\n                this.move_node(src_node, target_node, target_direct);\n            }\n            this.hide_shadow();\n        }\n        this.view_panel_rect = null;\n        this.moved = false;\n        this.capture = false;\n    }\n    move_node(src_node, target_node, target_direct) {\n        var shadow_h = this.shadow.offsetTop;\n        if (!!target_node && !!src_node && !jsMind.node.inherited(src_node, target_node)) {\n            // lookup before_node\n            var sibling_nodes = target_node.children;\n            var sc = sibling_nodes.length;\n            var node = null;\n            var delta_y = Number.MAX_VALUE;\n            var node_before = null;\n            var beforeid = '_last_';\n            while (sc--) {\n                node = sibling_nodes[sc];\n                if (node.direction == target_direct && node.id != src_node.id) {\n                    var dy = node.get_location().y - shadow_h;\n                    if (dy > 0 && dy < delta_y) {\n                        delta_y = dy;\n                        node_before = node;\n                        beforeid = '_first_';\n                    }\n                }\n            }\n            if (!!node_before) {\n                beforeid = node_before.id;\n            }\n            this.jm.move_node(src_node.id, beforeid, target_node.id, target_direct);\n        }\n        this.active_node = null;\n        this.target_node = null;\n        this.target_direct = null;\n    }\n    jm_event_handle(type, data) {\n        if (type === jsMind.event_type.resize) {\n            this.resize();\n        }\n    }\n}\n\nvar draggable_plugin = new jsMind.plugin('draggable_node', function (jm, options) {\n    var jd = new DraggableNode(jm, options);\n    jd.init();\n    jm.add_event_listener(function (type, data) {\n        jd.jm_event_handle.call(jd, type, data);\n    });\n});\n\njsMind.register_plugin(draggable_plugin);\n"],"names":["jsMind","Error","$","clear_selection","w","getSelection","removeAllRanges","d","selection","empty","DEFAULT_OPTIONS","line_width","line_color","drag_start_delay","lookup_delay","lookup_interval","scrolling_trigger_width","scrolling_step_length","DraggableNode","constructor","jm","options","opts","util","json","merge","this","version","e_canvas","canvas_ctx","shadow","shadow_w","shadow_h","active_node","target_node","target_direct","client_w","client_h","offset_x","offset_y","hlookup_delay","hlookup_timer","hdrag_start_delay","capture","moved","canvas_draggable","get_view_draggable","view_panel","view","e_panel","view_panel_rect","init","_create_canvas","_create_shadow","_event_bind","resize","e_nodes","appendChild","width","size","height","h","c","ctx","getContext","s","style","visibility","zIndex","cursor","opacity","reset_shadow","el","innerHTML","left","top","backgroundImage","backgroundSize","transform","clientWidth","clientHeight","show_shadow","hide_shadow","_magnet_shadow","node","lineWidth","strokeStyle","lineCap","_clear_lines","_canvas_lineto","sp","x","y","np","clearRect","x1","y1","x2","y2","beginPath","moveTo","lineTo","stroke","_lookup_close_node","ns","nl","root","get_root","root_location","get_location","root_size","get_size","root_x","sw","sh","sx","offsetLeft","sy","offsetTop","direct","direction","right","nodes","mind","layout","min_distance","Number","MAX_VALUE","distance","closest_node","closest_p","shadow_p","nodeid","isroot","id","is_visible","Math","abs","result_node","lookup_close_node","node_data","jd","container","on","e","evt","event","setTimeout","dragstart","call","drag","clearTimeout","dragend","get_editable","view_draggable","jview","target","srcElement","tagName","toLowerCase","disable_view_draggable","get_binded_nodeid","get_node","getBoundingClientRect","clientX","touches","zoom_current","clientY","client_hw","floor","client_hh","clearInterval","setInterval","preventDefault","px","py","scrollTop","scrollBy","bottom","scrollHeight","scrollLeft","scrollWidth","enable_view_draggable","src_node","move_node","inherited","sibling_nodes","children","sc","length","delta_y","node_before","beforeid","dy","jm_event_handle","type","data","event_type","draggable_plugin","plugin","add_event_listener","register_plugin"],"mappings":"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"}